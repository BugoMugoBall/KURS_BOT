# KURS_BOT

Документация для EnglishCardBot

1. Введение

Описание: EnglishCardBot – это Telegram-бот, предназначенный для изучения английских слов. Бот позволяет пользователям добавлять новые слова, удалять их из списка для изучения и практиковаться в переводе слов с русского на английский.
Технологии:
Язык программирования: Python 3
Библиотеки:
telebot: Для работы с Telegram Bot API.
psycopg2: Для подключения к базе данных PostgreSQL.
random: Для генерации случайных чисел (например, при выборе слов для тренировки).
База данных: PostgreSQL
Целевая аудитория:
Пользователи, изучающие английский язык.
Разработчики, желающие внести изменения или расширить функциональность бота.
2. Установка и настройка

Предварительные условия:

Python 3.6 или выше
Установленный PostgreSQL
Созданная база данных PostgreSQL (например, english_cards)
Настройка переменных окружения:

Создайте файл config.py (или .env) и определите следующие переменные:

python

TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"
PARAMS = {
    'dbname': 'your_db_name',
    'user': 'your_user',
    'password': 'your_password',
    'host': 'your_host',
    'port': 'your_port'
}
Замените YOUR_TELEGRAM_BOT_TOKEN на токен вашего бота, полученный от BotFather в Telegram.

Замените your_db_name, your_user, your_password, your_host, your_port на параметры вашей базы данных PostgreSQL.

Установка зависимостей:

bash

pip install telebot psycopg2-binary
3. Архитектура

Основные классы:

DatabaseManager: Отвечает за взаимодействие с базой данных PostgreSQL.
EnglishCardBot: Основной класс бота, обрабатывающий логику взаимодействия с пользователем и управление базой данных.
Структура базы данных:

Таблица users:

user_id SERIAL PRIMARY KEY
telegram_id BIGINT UNIQUE
username VARCHAR(255)
first_name VARCHAR(255)
last_name VARCHAR(255)
Таблица words:

word_id SERIAL PRIMARY KEY
english VARCHAR(255) UNIQUE
russian VARCHAR(255)
Таблица user_words:

user_id INTEGER REFERENCES users(user_id)
word_id INTEGER REFERENCES words(word_id)
added_by_user BOOLEAN DEFAULT FALSE
PRIMARY KEY (user_id, word_id)
4. Класс DatabaseManager

Этот класс обеспечивает взаимодействие с базой данных PostgreSQL.

__init__(self, db_params):

Инициализирует подключение к базе данных, используя параметры из db_params.
get_user(self, telegram_id):

Получает информацию о пользователе из базы данных по его telegram_id.
create_user(self, telegram_id, username, first_name, last_name):

Создает нового пользователя в базе данных.
get_random_word(self, user_id):

Получает случайное слово из списка слов, связанных с пользователем, либо из общего списка слов, если у пользователя нет связанных слов.
get_word_by_id(self, word_id):

Получает слово из базы данных по его word_id.
add_word_to_user(self, user_id, english, russian):

Добавляет новое слово в базу данных (если его нет) и связывает его с пользователем.
delete_word_from_user(self, user_id, word_id):

Удаляет связь между пользователем и словом.
get_user_words_count(self, user_id):

Возвращает количество слов, связанных с пользователем.
close(self):

Закрывает соединение с базой данных.
5. Класс EnglishCardBot

Этот класс управляет логикой работы бота.

__init__(self, bot_token, db_params):

Инициализирует бота с использованием токена Telegram Bot API и параметров подключения к базе данных.
Создает экземпляр класса DatabaseManager.
Инициализирует словарь user_states для хранения состояний пользователей (например, во время добавления слова или тренировки).
register_handlers(self):

Регистрирует обработчики команд бота.
self.start: Обработчик команды /start.
self.handle_message: Обработчик всех текстовых сообщений.
start(self, message):

Обрабатывает команду /start.
Приветствует пользователя.
Регистрирует нового пользователя, если его нет в базе данных.
Отображает основное меню с кнопками “Добавить слово”, “Удалить слово”, “Начать тренировку”.
ask_question(self, user_id):

Выбирает случайное слово из списка слов пользователя.
Формирует вопрос с вариантами ответов (правильный и три неправильных).
Отправляет вопрос пользователю с клавиатурой.
Устанавливает состояние пользователя в waiting_answer.
handle_message(self, message):

Обрабатывает текстовые сообщения пользователя.
Определяет, какую команду выполнил пользователь (например, “Добавить слово”, “Удалить слово”, “Начать тренировку”, ответ на вопрос).
Вызывает соответствующие обработчики.
check_answer(self, message):

Проверяет ответ пользователя на вопрос тренировки.
Если ответ правильный, сообщает об этом пользователю и возвращает его в основное меню.
Если ответ неправильный, предлагает попробовать еще раз.
add_word_handler(self, message):

Обрабатывает запрос на добавление нового слова.
Запрашивает у пользователя английское слово.
Устанавливает состояние пользователя в waiting_english.
get_english_word(self, message):

Получает английское слово от пользователя.
Запрашивает у пользователя русский перевод.
Устанавливает состояние пользователя в waiting_russian.
get_russian_word(self, message):

Получает русский перевод от пользователя.
Добавляет новое слово в базу данных (если его еще нет) и связывает его с пользователем.
Сообщает пользователю об успешном добавлении слова.
delete_word_handler(self, message):

Обрабатывает запрос на удаление слова.
Отображает пользователю список его слов для удаления.
Запрашивает подтверждение на удаление выбранного слова.
delete_word_confirm(self, message, user_words):

Подтверждает удаление слова.
Удаляет связь между пользователем и словом.
Сообщает пользователю об успешном удалении слова.
run(self):

Запускает бота в режиме бесконечного опроса (infinity_polling).